{"ast":null,"code":"import { __awaiter, __generator } from \"tslib\";\nimport { a as addEventListener, b as removeEventListener, p as pointerCoord } from './helpers-47d562d2.js';\nvar cloneMap = new WeakMap();\n\nvar relocateInput = function relocateInput(componentEl, inputEl, shouldRelocate, inputRelativeY) {\n  if (inputRelativeY === void 0) {\n    inputRelativeY = 0;\n  }\n\n  if (cloneMap.has(componentEl) === shouldRelocate) {\n    return;\n  }\n\n  if (shouldRelocate) {\n    addClone(componentEl, inputEl, inputRelativeY);\n  } else {\n    removeClone(componentEl, inputEl);\n  }\n};\n\nvar isFocused = function isFocused(input) {\n  return input === input.getRootNode().activeElement;\n};\n\nvar addClone = function addClone(componentEl, inputEl, inputRelativeY) {\n  // this allows for the actual input to receive the focus from\n  // the user's touch event, but before it receives focus, it\n  // moves the actual input to a location that will not screw\n  // up the app's layout, and does not allow the native browser\n  // to attempt to scroll the input into place (messing up headers/footers)\n  // the cloned input fills the area of where native input should be\n  // while the native input fakes out the browser by relocating itself\n  // before it receives the actual focus event\n  // We hide the focused input (with the visible caret) invisible by making it scale(0),\n  var parentEl = inputEl.parentNode; // DOM WRITES\n\n  var clonedEl = inputEl.cloneNode(false);\n  clonedEl.classList.add('cloned-input');\n  clonedEl.tabIndex = -1;\n  parentEl.appendChild(clonedEl);\n  cloneMap.set(componentEl, clonedEl);\n  var doc = componentEl.ownerDocument;\n  var tx = doc.dir === 'rtl' ? 9999 : -9999;\n  componentEl.style.pointerEvents = 'none';\n  inputEl.style.transform = \"translate3d(\" + tx + \"px,\" + inputRelativeY + \"px,0) scale(0)\";\n};\n\nvar removeClone = function removeClone(componentEl, inputEl) {\n  var clone = cloneMap.get(componentEl);\n\n  if (clone) {\n    cloneMap.delete(componentEl);\n    clone.remove();\n  }\n\n  componentEl.style.pointerEvents = '';\n  inputEl.style.transform = '';\n};\n\nvar enableHideCaretOnScroll = function enableHideCaretOnScroll(componentEl, inputEl, scrollEl) {\n  if (!scrollEl || !inputEl) {\n    return function () {\n      return;\n    };\n  }\n\n  var scrollHideCaret = function scrollHideCaret(shouldHideCaret) {\n    if (isFocused(inputEl)) {\n      relocateInput(componentEl, inputEl, shouldHideCaret);\n    }\n  };\n\n  var onBlur = function onBlur() {\n    return relocateInput(componentEl, inputEl, false);\n  };\n\n  var hideCaret = function hideCaret() {\n    return scrollHideCaret(true);\n  };\n\n  var showCaret = function showCaret() {\n    return scrollHideCaret(false);\n  };\n\n  addEventListener(scrollEl, 'ionScrollStart', hideCaret);\n  addEventListener(scrollEl, 'ionScrollEnd', showCaret);\n  inputEl.addEventListener('blur', onBlur);\n  return function () {\n    removeEventListener(scrollEl, 'ionScrollStart', hideCaret);\n    removeEventListener(scrollEl, 'ionScrollEnd', showCaret);\n    inputEl.addEventListener('ionBlur', onBlur);\n  };\n};\n\nvar SKIP_SELECTOR = 'input, textarea, [no-blur]';\n\nvar enableInputBlurring = function enableInputBlurring() {\n  var focused = true;\n  var didScroll = false;\n  var doc = document;\n\n  var onScroll = function onScroll() {\n    didScroll = true;\n  };\n\n  var onFocusin = function onFocusin() {\n    focused = true;\n  };\n\n  var onTouchend = function onTouchend(ev) {\n    // if app did scroll return early\n    if (didScroll) {\n      didScroll = false;\n      return;\n    }\n\n    var active = doc.activeElement;\n\n    if (!active) {\n      return;\n    } // only blur if the active element is a text-input or a textarea\n\n\n    if (active.matches(SKIP_SELECTOR)) {\n      return;\n    } // if the selected target is the active element, do not blur\n\n\n    var tapped = ev.target;\n\n    if (tapped === active) {\n      return;\n    }\n\n    if (tapped.matches(SKIP_SELECTOR) || tapped.closest(SKIP_SELECTOR)) {\n      return;\n    }\n\n    focused = false; // TODO: find a better way, why 50ms?\n\n    setTimeout(function () {\n      if (!focused) {\n        active.blur();\n      }\n    }, 50);\n  };\n\n  addEventListener(doc, 'ionScrollStart', onScroll);\n  doc.addEventListener('focusin', onFocusin, true);\n  doc.addEventListener('touchend', onTouchend, false);\n  return function () {\n    removeEventListener(doc, 'ionScrollStart', onScroll, true);\n    doc.removeEventListener('focusin', onFocusin, true);\n    doc.removeEventListener('touchend', onTouchend, false);\n  };\n};\n\nvar SCROLL_ASSIST_SPEED = 0.3;\n\nvar getScrollData = function getScrollData(componentEl, contentEl, keyboardHeight) {\n  var itemEl = componentEl.closest('ion-item,[ion-item]') || componentEl;\n  return calcScrollData(itemEl.getBoundingClientRect(), contentEl.getBoundingClientRect(), keyboardHeight, componentEl.ownerDocument.defaultView.innerHeight);\n};\n\nvar calcScrollData = function calcScrollData(inputRect, contentRect, keyboardHeight, platformHeight) {\n  // compute input's Y values relative to the body\n  var inputTop = inputRect.top;\n  var inputBottom = inputRect.bottom; // compute visible area\n\n  var visibleAreaTop = contentRect.top;\n  var visibleAreaBottom = Math.min(contentRect.bottom, platformHeight - keyboardHeight); // compute safe area\n\n  var safeAreaTop = visibleAreaTop + 15;\n  var safeAreaBottom = visibleAreaBottom * 0.75; // figure out if each edge of the input is within the safe area\n\n  var distanceToBottom = safeAreaBottom - inputBottom;\n  var distanceToTop = safeAreaTop - inputTop; // desiredScrollAmount is the negated distance to the safe area according to our calculations.\n\n  var desiredScrollAmount = Math.round(distanceToBottom < 0 ? -distanceToBottom : distanceToTop > 0 ? -distanceToTop : 0); // our calculations make some assumptions that aren't always true, like the keyboard being closed when an input\n  // gets focus, so make sure we don't scroll the input above the visible area\n\n  var scrollAmount = Math.min(desiredScrollAmount, inputTop - visibleAreaTop);\n  var distance = Math.abs(scrollAmount);\n  var duration = distance / SCROLL_ASSIST_SPEED;\n  var scrollDuration = Math.min(400, Math.max(150, duration));\n  return {\n    scrollAmount: scrollAmount,\n    scrollDuration: scrollDuration,\n    scrollPadding: keyboardHeight,\n    inputSafeY: -(inputTop - safeAreaTop) + 4\n  };\n};\n\nvar enableScrollAssist = function enableScrollAssist(componentEl, inputEl, contentEl, footerEl, keyboardHeight) {\n  var coord;\n\n  var touchStart = function touchStart(ev) {\n    coord = pointerCoord(ev);\n  };\n\n  var touchEnd = function touchEnd(ev) {\n    // input cover touchend/mouseup\n    if (!coord) {\n      return;\n    } // get where the touchend/mouseup ended\n\n\n    var endCoord = pointerCoord(ev); // focus this input if the pointer hasn't moved XX pixels\n    // and the input doesn't already have focus\n\n    if (!hasPointerMoved(6, coord, endCoord) && !isFocused(inputEl)) {\n      ev.preventDefault();\n      ev.stopPropagation(); // begin the input focus process\n\n      jsSetFocus(componentEl, inputEl, contentEl, footerEl, keyboardHeight);\n    }\n  };\n\n  componentEl.addEventListener('touchstart', touchStart, true);\n  componentEl.addEventListener('touchend', touchEnd, true);\n  return function () {\n    componentEl.removeEventListener('touchstart', touchStart, true);\n    componentEl.removeEventListener('touchend', touchEnd, true);\n  };\n};\n\nvar jsSetFocus = function jsSetFocus(componentEl, inputEl, contentEl, footerEl, keyboardHeight) {\n  return __awaiter(void 0, void 0, void 0, function () {\n    var scrollData, scrollContentTimeout_1, _scrollContent_, _doubleKeyboardEventListener_, scrollEl, totalScrollAmount;\n\n    return __generator(this, function (_a) {\n      switch (_a.label) {\n        case 0:\n          if (!contentEl && !footerEl) {\n            return [2\n            /*return*/\n            ];\n          }\n\n          scrollData = getScrollData(componentEl, contentEl || footerEl, keyboardHeight);\n\n          if (contentEl && Math.abs(scrollData.scrollAmount) < 4) {\n            // the text input is in a safe position that doesn't\n            // require it to be scrolled into view, just set focus now\n            inputEl.focus();\n            return [2\n            /*return*/\n            ];\n          } // temporarily move the focus to the focus holder so the browser\n          // doesn't freak out while it's trying to get the input in place\n          // at this point the native text input still does not have focus\n\n\n          relocateInput(componentEl, inputEl, true, scrollData.inputSafeY);\n          inputEl.focus();\n          if (!(typeof window !== 'undefined')) return [3\n          /*break*/\n          , 3];\n\n          _scrollContent_ = function scrollContent_1() {\n            return __awaiter(void 0, void 0, void 0, function () {\n              return __generator(this, function (_a) {\n                switch (_a.label) {\n                  case 0:\n                    // clean up listeners and timeouts\n                    if (scrollContentTimeout_1 !== undefined) {\n                      clearTimeout(scrollContentTimeout_1);\n                    }\n\n                    window.removeEventListener('ionKeyboardDidShow', _doubleKeyboardEventListener_);\n                    window.removeEventListener('ionKeyboardDidShow', _scrollContent_);\n                    if (!contentEl) return [3\n                    /*break*/\n                    , 2];\n                    return [4\n                    /*yield*/\n                    , contentEl.scrollByPoint(0, scrollData.scrollAmount, scrollData.scrollDuration)];\n\n                  case 1:\n                    _a.sent();\n\n                    _a.label = 2;\n\n                  case 2:\n                    // the scroll view is in the correct position now\n                    // give the native text input focus\n                    relocateInput(componentEl, inputEl, false, scrollData.inputSafeY); // ensure this is the focused input\n\n                    inputEl.focus();\n                    return [2\n                    /*return*/\n                    ];\n                }\n              });\n            });\n          };\n\n          _doubleKeyboardEventListener_ = function doubleKeyboardEventListener_1() {\n            window.removeEventListener('ionKeyboardDidShow', _doubleKeyboardEventListener_);\n            window.addEventListener('ionKeyboardDidShow', _scrollContent_);\n          };\n\n          if (!contentEl) return [3\n          /*break*/\n          , 2];\n          return [4\n          /*yield*/\n          , contentEl.getScrollElement()];\n\n        case 1:\n          scrollEl = _a.sent();\n          totalScrollAmount = scrollEl.scrollHeight - scrollEl.clientHeight;\n\n          if (scrollData.scrollAmount > totalScrollAmount - scrollEl.scrollTop) {\n            /**\r\n             * On iOS devices, the system will show a \"Passwords\" bar above the keyboard\r\n             * after the initial keyboard is shown. This prevents the webview from resizing\r\n             * until the \"Passwords\" bar is shown, so we need to wait for that to happen first.\r\n             */\n            if (inputEl.type === 'password') {\n              // Add 50px to account for the \"Passwords\" bar\n              scrollData.scrollAmount += 50;\n              window.addEventListener('ionKeyboardDidShow', _doubleKeyboardEventListener_);\n            } else {\n              window.addEventListener('ionKeyboardDidShow', _scrollContent_);\n            }\n            /**\r\n             * This should only fire in 2 instances:\r\n             * 1. The app is very slow.\r\n             * 2. The app is running in a browser on an old OS\r\n             * that does not support Ionic Keyboard Events\r\n             */\n\n\n            scrollContentTimeout_1 = setTimeout(_scrollContent_, 1000);\n            return [2\n            /*return*/\n            ];\n          }\n\n          _a.label = 2;\n\n        case 2:\n          _scrollContent_();\n\n          _a.label = 3;\n\n        case 3:\n          return [2\n          /*return*/\n          ];\n      }\n    });\n  });\n};\n\nvar hasPointerMoved = function hasPointerMoved(threshold, startCoord, endCoord) {\n  if (startCoord && endCoord) {\n    var deltaX = startCoord.x - endCoord.x;\n    var deltaY = startCoord.y - endCoord.y;\n    var distance = deltaX * deltaX + deltaY * deltaY;\n    return distance > threshold * threshold;\n  }\n\n  return false;\n};\n\nvar PADDING_TIMER_KEY = '$ionPaddingTimer';\n\nvar enableScrollPadding = function enableScrollPadding(keyboardHeight) {\n  var doc = document;\n\n  var onFocusin = function onFocusin(ev) {\n    setScrollPadding(ev.target, keyboardHeight);\n  };\n\n  var onFocusout = function onFocusout(ev) {\n    setScrollPadding(ev.target, 0);\n  };\n\n  doc.addEventListener('focusin', onFocusin);\n  doc.addEventListener('focusout', onFocusout);\n  return function () {\n    doc.removeEventListener('focusin', onFocusin);\n    doc.removeEventListener('focusout', onFocusout);\n  };\n};\n\nvar setScrollPadding = function setScrollPadding(input, keyboardHeight) {\n  if (input.tagName !== 'INPUT') {\n    return;\n  }\n\n  if (input.parentElement && input.parentElement.tagName === 'ION-INPUT') {\n    return;\n  }\n\n  if (input.parentElement && input.parentElement.parentElement && input.parentElement.parentElement.tagName === 'ION-SEARCHBAR') {\n    return;\n  }\n\n  var el = input.closest('ion-content');\n\n  if (el === null) {\n    return;\n  }\n\n  var timer = el[PADDING_TIMER_KEY];\n\n  if (timer) {\n    clearTimeout(timer);\n  }\n\n  if (keyboardHeight > 0) {\n    el.style.setProperty('--keyboard-offset', keyboardHeight + \"px\");\n  } else {\n    el[PADDING_TIMER_KEY] = setTimeout(function () {\n      el.style.setProperty('--keyboard-offset', '0px');\n    }, 120);\n  }\n};\n\nvar INPUT_BLURRING = true;\nvar SCROLL_PADDING = true;\n\nvar startInputShims = function startInputShims(config) {\n  var doc = document;\n  var keyboardHeight = config.getNumber('keyboardHeight', 290);\n  var scrollAssist = config.getBoolean('scrollAssist', true);\n  var hideCaret = config.getBoolean('hideCaretOnScroll', true);\n  var inputBlurring = config.getBoolean('inputBlurring', true);\n  var scrollPadding = config.getBoolean('scrollPadding', true);\n  var inputs = Array.from(doc.querySelectorAll('ion-input, ion-textarea'));\n  var hideCaretMap = new WeakMap();\n  var scrollAssistMap = new WeakMap();\n\n  var registerInput = function registerInput(componentEl) {\n    return __awaiter(void 0, void 0, void 0, function () {\n      var inputRoot, inputEl, scrollEl, footerEl, rmFn, rmFn;\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            if (!componentEl.componentOnReady) return [3\n            /*break*/\n            , 2];\n            return [4\n            /*yield*/\n            , componentEl.componentOnReady()];\n\n          case 1:\n            _a.sent();\n\n            _a.label = 2;\n\n          case 2:\n            inputRoot = componentEl.shadowRoot || componentEl;\n            inputEl = inputRoot.querySelector('input') || inputRoot.querySelector('textarea');\n            scrollEl = componentEl.closest('ion-content');\n            footerEl = !scrollEl ? componentEl.closest('ion-footer') : null;\n\n            if (!inputEl) {\n              return [2\n              /*return*/\n              ];\n            }\n\n            if (!!scrollEl && hideCaret && !hideCaretMap.has(componentEl)) {\n              rmFn = enableHideCaretOnScroll(componentEl, inputEl, scrollEl);\n              hideCaretMap.set(componentEl, rmFn);\n            }\n\n            if ((!!scrollEl || !!footerEl) && scrollAssist && !scrollAssistMap.has(componentEl)) {\n              rmFn = enableScrollAssist(componentEl, inputEl, scrollEl, footerEl, keyboardHeight);\n              scrollAssistMap.set(componentEl, rmFn);\n            }\n\n            return [2\n            /*return*/\n            ];\n        }\n      });\n    });\n  };\n\n  var unregisterInput = function unregisterInput(componentEl) {\n    if (hideCaret) {\n      var fn = hideCaretMap.get(componentEl);\n\n      if (fn) {\n        fn();\n      }\n\n      hideCaretMap.delete(componentEl);\n    }\n\n    if (scrollAssist) {\n      var fn = scrollAssistMap.get(componentEl);\n\n      if (fn) {\n        fn();\n      }\n\n      scrollAssistMap.delete(componentEl);\n    }\n  };\n\n  if (inputBlurring && INPUT_BLURRING) {\n    enableInputBlurring();\n  }\n\n  if (scrollPadding && SCROLL_PADDING) {\n    enableScrollPadding(keyboardHeight);\n  } // Input might be already loaded in the DOM before ion-device-hacks did.\n  // At this point we need to look for all of the inputs not registered yet\n  // and register them.\n\n\n  for (var _i = 0, inputs_1 = inputs; _i < inputs_1.length; _i++) {\n    var input = inputs_1[_i];\n    registerInput(input);\n  }\n\n  doc.addEventListener('ionInputDidLoad', function (ev) {\n    registerInput(ev.detail);\n  });\n  doc.addEventListener('ionInputDidUnload', function (ev) {\n    unregisterInput(ev.detail);\n  });\n};\n\nexport { startInputShims };","map":{"version":3,"sources":["C:/Users/Nick/Desktop/LED-Helmet-Cosplay-Companion/cosplay-companion/node_modules/@ionic/core/dist/esm-es5/input-shims-ba28b23a.js"],"names":["__awaiter","__generator","a","addEventListener","b","removeEventListener","p","pointerCoord","cloneMap","WeakMap","relocateInput","componentEl","inputEl","shouldRelocate","inputRelativeY","has","addClone","removeClone","isFocused","input","getRootNode","activeElement","parentEl","parentNode","clonedEl","cloneNode","classList","add","tabIndex","appendChild","set","doc","ownerDocument","tx","dir","style","pointerEvents","transform","clone","get","delete","remove","enableHideCaretOnScroll","scrollEl","scrollHideCaret","shouldHideCaret","onBlur","hideCaret","showCaret","SKIP_SELECTOR","enableInputBlurring","focused","didScroll","document","onScroll","onFocusin","onTouchend","ev","active","matches","tapped","target","closest","setTimeout","blur","SCROLL_ASSIST_SPEED","getScrollData","contentEl","keyboardHeight","itemEl","calcScrollData","getBoundingClientRect","defaultView","innerHeight","inputRect","contentRect","platformHeight","inputTop","top","inputBottom","bottom","visibleAreaTop","visibleAreaBottom","Math","min","safeAreaTop","safeAreaBottom","distanceToBottom","distanceToTop","desiredScrollAmount","round","scrollAmount","distance","abs","duration","scrollDuration","max","scrollPadding","inputSafeY","enableScrollAssist","footerEl","coord","touchStart","touchEnd","endCoord","hasPointerMoved","preventDefault","stopPropagation","jsSetFocus","scrollData","scrollContentTimeout_1","scrollContent_1","doubleKeyboardEventListener_1","totalScrollAmount","_a","label","focus","window","undefined","clearTimeout","scrollByPoint","sent","getScrollElement","scrollHeight","clientHeight","scrollTop","type","threshold","startCoord","deltaX","x","deltaY","y","PADDING_TIMER_KEY","enableScrollPadding","setScrollPadding","onFocusout","tagName","parentElement","el","timer","setProperty","INPUT_BLURRING","SCROLL_PADDING","startInputShims","config","getNumber","scrollAssist","getBoolean","inputBlurring","inputs","Array","from","querySelectorAll","hideCaretMap","scrollAssistMap","registerInput","inputRoot","rmFn","componentOnReady","shadowRoot","querySelector","unregisterInput","fn","_i","inputs_1","length","detail"],"mappings":"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","sourcesContent":["import { __awaiter, __generator } from \"tslib\";\r\nimport { a as addEventListener, b as removeEventListener, p as pointerCoord } from './helpers-47d562d2.js';\r\nvar cloneMap = new WeakMap();\r\nvar relocateInput = function (componentEl, inputEl, shouldRelocate, inputRelativeY) {\r\n    if (inputRelativeY === void 0) { inputRelativeY = 0; }\r\n    if (cloneMap.has(componentEl) === shouldRelocate) {\r\n        return;\r\n    }\r\n    if (shouldRelocate) {\r\n        addClone(componentEl, inputEl, inputRelativeY);\r\n    }\r\n    else {\r\n        removeClone(componentEl, inputEl);\r\n    }\r\n};\r\nvar isFocused = function (input) {\r\n    return input === input.getRootNode().activeElement;\r\n};\r\nvar addClone = function (componentEl, inputEl, inputRelativeY) {\r\n    // this allows for the actual input to receive the focus from\r\n    // the user's touch event, but before it receives focus, it\r\n    // moves the actual input to a location that will not screw\r\n    // up the app's layout, and does not allow the native browser\r\n    // to attempt to scroll the input into place (messing up headers/footers)\r\n    // the cloned input fills the area of where native input should be\r\n    // while the native input fakes out the browser by relocating itself\r\n    // before it receives the actual focus event\r\n    // We hide the focused input (with the visible caret) invisible by making it scale(0),\r\n    var parentEl = inputEl.parentNode;\r\n    // DOM WRITES\r\n    var clonedEl = inputEl.cloneNode(false);\r\n    clonedEl.classList.add('cloned-input');\r\n    clonedEl.tabIndex = -1;\r\n    parentEl.appendChild(clonedEl);\r\n    cloneMap.set(componentEl, clonedEl);\r\n    var doc = componentEl.ownerDocument;\r\n    var tx = doc.dir === 'rtl' ? 9999 : -9999;\r\n    componentEl.style.pointerEvents = 'none';\r\n    inputEl.style.transform = \"translate3d(\" + tx + \"px,\" + inputRelativeY + \"px,0) scale(0)\";\r\n};\r\nvar removeClone = function (componentEl, inputEl) {\r\n    var clone = cloneMap.get(componentEl);\r\n    if (clone) {\r\n        cloneMap.delete(componentEl);\r\n        clone.remove();\r\n    }\r\n    componentEl.style.pointerEvents = '';\r\n    inputEl.style.transform = '';\r\n};\r\nvar enableHideCaretOnScroll = function (componentEl, inputEl, scrollEl) {\r\n    if (!scrollEl || !inputEl) {\r\n        return function () { return; };\r\n    }\r\n    var scrollHideCaret = function (shouldHideCaret) {\r\n        if (isFocused(inputEl)) {\r\n            relocateInput(componentEl, inputEl, shouldHideCaret);\r\n        }\r\n    };\r\n    var onBlur = function () { return relocateInput(componentEl, inputEl, false); };\r\n    var hideCaret = function () { return scrollHideCaret(true); };\r\n    var showCaret = function () { return scrollHideCaret(false); };\r\n    addEventListener(scrollEl, 'ionScrollStart', hideCaret);\r\n    addEventListener(scrollEl, 'ionScrollEnd', showCaret);\r\n    inputEl.addEventListener('blur', onBlur);\r\n    return function () {\r\n        removeEventListener(scrollEl, 'ionScrollStart', hideCaret);\r\n        removeEventListener(scrollEl, 'ionScrollEnd', showCaret);\r\n        inputEl.addEventListener('ionBlur', onBlur);\r\n    };\r\n};\r\nvar SKIP_SELECTOR = 'input, textarea, [no-blur]';\r\nvar enableInputBlurring = function () {\r\n    var focused = true;\r\n    var didScroll = false;\r\n    var doc = document;\r\n    var onScroll = function () {\r\n        didScroll = true;\r\n    };\r\n    var onFocusin = function () {\r\n        focused = true;\r\n    };\r\n    var onTouchend = function (ev) {\r\n        // if app did scroll return early\r\n        if (didScroll) {\r\n            didScroll = false;\r\n            return;\r\n        }\r\n        var active = doc.activeElement;\r\n        if (!active) {\r\n            return;\r\n        }\r\n        // only blur if the active element is a text-input or a textarea\r\n        if (active.matches(SKIP_SELECTOR)) {\r\n            return;\r\n        }\r\n        // if the selected target is the active element, do not blur\r\n        var tapped = ev.target;\r\n        if (tapped === active) {\r\n            return;\r\n        }\r\n        if (tapped.matches(SKIP_SELECTOR) || tapped.closest(SKIP_SELECTOR)) {\r\n            return;\r\n        }\r\n        focused = false;\r\n        // TODO: find a better way, why 50ms?\r\n        setTimeout(function () {\r\n            if (!focused) {\r\n                active.blur();\r\n            }\r\n        }, 50);\r\n    };\r\n    addEventListener(doc, 'ionScrollStart', onScroll);\r\n    doc.addEventListener('focusin', onFocusin, true);\r\n    doc.addEventListener('touchend', onTouchend, false);\r\n    return function () {\r\n        removeEventListener(doc, 'ionScrollStart', onScroll, true);\r\n        doc.removeEventListener('focusin', onFocusin, true);\r\n        doc.removeEventListener('touchend', onTouchend, false);\r\n    };\r\n};\r\nvar SCROLL_ASSIST_SPEED = 0.3;\r\nvar getScrollData = function (componentEl, contentEl, keyboardHeight) {\r\n    var itemEl = componentEl.closest('ion-item,[ion-item]') || componentEl;\r\n    return calcScrollData(itemEl.getBoundingClientRect(), contentEl.getBoundingClientRect(), keyboardHeight, componentEl.ownerDocument.defaultView.innerHeight);\r\n};\r\nvar calcScrollData = function (inputRect, contentRect, keyboardHeight, platformHeight) {\r\n    // compute input's Y values relative to the body\r\n    var inputTop = inputRect.top;\r\n    var inputBottom = inputRect.bottom;\r\n    // compute visible area\r\n    var visibleAreaTop = contentRect.top;\r\n    var visibleAreaBottom = Math.min(contentRect.bottom, platformHeight - keyboardHeight);\r\n    // compute safe area\r\n    var safeAreaTop = visibleAreaTop + 15;\r\n    var safeAreaBottom = visibleAreaBottom * 0.75;\r\n    // figure out if each edge of the input is within the safe area\r\n    var distanceToBottom = safeAreaBottom - inputBottom;\r\n    var distanceToTop = safeAreaTop - inputTop;\r\n    // desiredScrollAmount is the negated distance to the safe area according to our calculations.\r\n    var desiredScrollAmount = Math.round((distanceToBottom < 0)\r\n        ? -distanceToBottom\r\n        : (distanceToTop > 0)\r\n            ? -distanceToTop\r\n            : 0);\r\n    // our calculations make some assumptions that aren't always true, like the keyboard being closed when an input\r\n    // gets focus, so make sure we don't scroll the input above the visible area\r\n    var scrollAmount = Math.min(desiredScrollAmount, inputTop - visibleAreaTop);\r\n    var distance = Math.abs(scrollAmount);\r\n    var duration = distance / SCROLL_ASSIST_SPEED;\r\n    var scrollDuration = Math.min(400, Math.max(150, duration));\r\n    return {\r\n        scrollAmount: scrollAmount,\r\n        scrollDuration: scrollDuration,\r\n        scrollPadding: keyboardHeight,\r\n        inputSafeY: -(inputTop - safeAreaTop) + 4\r\n    };\r\n};\r\nvar enableScrollAssist = function (componentEl, inputEl, contentEl, footerEl, keyboardHeight) {\r\n    var coord;\r\n    var touchStart = function (ev) {\r\n        coord = pointerCoord(ev);\r\n    };\r\n    var touchEnd = function (ev) {\r\n        // input cover touchend/mouseup\r\n        if (!coord) {\r\n            return;\r\n        }\r\n        // get where the touchend/mouseup ended\r\n        var endCoord = pointerCoord(ev);\r\n        // focus this input if the pointer hasn't moved XX pixels\r\n        // and the input doesn't already have focus\r\n        if (!hasPointerMoved(6, coord, endCoord) && !isFocused(inputEl)) {\r\n            ev.preventDefault();\r\n            ev.stopPropagation();\r\n            // begin the input focus process\r\n            jsSetFocus(componentEl, inputEl, contentEl, footerEl, keyboardHeight);\r\n        }\r\n    };\r\n    componentEl.addEventListener('touchstart', touchStart, true);\r\n    componentEl.addEventListener('touchend', touchEnd, true);\r\n    return function () {\r\n        componentEl.removeEventListener('touchstart', touchStart, true);\r\n        componentEl.removeEventListener('touchend', touchEnd, true);\r\n    };\r\n};\r\nvar jsSetFocus = function (componentEl, inputEl, contentEl, footerEl, keyboardHeight) { return __awaiter(void 0, void 0, void 0, function () {\r\n    var scrollData, scrollContentTimeout_1, scrollContent_1, doubleKeyboardEventListener_1, scrollEl, totalScrollAmount;\r\n    return __generator(this, function (_a) {\r\n        switch (_a.label) {\r\n            case 0:\r\n                if (!contentEl && !footerEl) {\r\n                    return [2 /*return*/];\r\n                }\r\n                scrollData = getScrollData(componentEl, (contentEl || footerEl), keyboardHeight);\r\n                if (contentEl && Math.abs(scrollData.scrollAmount) < 4) {\r\n                    // the text input is in a safe position that doesn't\r\n                    // require it to be scrolled into view, just set focus now\r\n                    inputEl.focus();\r\n                    return [2 /*return*/];\r\n                }\r\n                // temporarily move the focus to the focus holder so the browser\r\n                // doesn't freak out while it's trying to get the input in place\r\n                // at this point the native text input still does not have focus\r\n                relocateInput(componentEl, inputEl, true, scrollData.inputSafeY);\r\n                inputEl.focus();\r\n                if (!(typeof window !== 'undefined')) return [3 /*break*/, 3];\r\n                scrollContent_1 = function () { return __awaiter(void 0, void 0, void 0, function () {\r\n                    return __generator(this, function (_a) {\r\n                        switch (_a.label) {\r\n                            case 0:\r\n                                // clean up listeners and timeouts\r\n                                if (scrollContentTimeout_1 !== undefined) {\r\n                                    clearTimeout(scrollContentTimeout_1);\r\n                                }\r\n                                window.removeEventListener('ionKeyboardDidShow', doubleKeyboardEventListener_1);\r\n                                window.removeEventListener('ionKeyboardDidShow', scrollContent_1);\r\n                                if (!contentEl) return [3 /*break*/, 2];\r\n                                return [4 /*yield*/, contentEl.scrollByPoint(0, scrollData.scrollAmount, scrollData.scrollDuration)];\r\n                            case 1:\r\n                                _a.sent();\r\n                                _a.label = 2;\r\n                            case 2:\r\n                                // the scroll view is in the correct position now\r\n                                // give the native text input focus\r\n                                relocateInput(componentEl, inputEl, false, scrollData.inputSafeY);\r\n                                // ensure this is the focused input\r\n                                inputEl.focus();\r\n                                return [2 /*return*/];\r\n                        }\r\n                    });\r\n                }); };\r\n                doubleKeyboardEventListener_1 = function () {\r\n                    window.removeEventListener('ionKeyboardDidShow', doubleKeyboardEventListener_1);\r\n                    window.addEventListener('ionKeyboardDidShow', scrollContent_1);\r\n                };\r\n                if (!contentEl) return [3 /*break*/, 2];\r\n                return [4 /*yield*/, contentEl.getScrollElement()];\r\n            case 1:\r\n                scrollEl = _a.sent();\r\n                totalScrollAmount = scrollEl.scrollHeight - scrollEl.clientHeight;\r\n                if (scrollData.scrollAmount > (totalScrollAmount - scrollEl.scrollTop)) {\r\n                    /**\r\n                     * On iOS devices, the system will show a \"Passwords\" bar above the keyboard\r\n                     * after the initial keyboard is shown. This prevents the webview from resizing\r\n                     * until the \"Passwords\" bar is shown, so we need to wait for that to happen first.\r\n                     */\r\n                    if (inputEl.type === 'password') {\r\n                        // Add 50px to account for the \"Passwords\" bar\r\n                        scrollData.scrollAmount += 50;\r\n                        window.addEventListener('ionKeyboardDidShow', doubleKeyboardEventListener_1);\r\n                    }\r\n                    else {\r\n                        window.addEventListener('ionKeyboardDidShow', scrollContent_1);\r\n                    }\r\n                    /**\r\n                     * This should only fire in 2 instances:\r\n                     * 1. The app is very slow.\r\n                     * 2. The app is running in a browser on an old OS\r\n                     * that does not support Ionic Keyboard Events\r\n                     */\r\n                    scrollContentTimeout_1 = setTimeout(scrollContent_1, 1000);\r\n                    return [2 /*return*/];\r\n                }\r\n                _a.label = 2;\r\n            case 2:\r\n                scrollContent_1();\r\n                _a.label = 3;\r\n            case 3: return [2 /*return*/];\r\n        }\r\n    });\r\n}); };\r\nvar hasPointerMoved = function (threshold, startCoord, endCoord) {\r\n    if (startCoord && endCoord) {\r\n        var deltaX = (startCoord.x - endCoord.x);\r\n        var deltaY = (startCoord.y - endCoord.y);\r\n        var distance = deltaX * deltaX + deltaY * deltaY;\r\n        return distance > (threshold * threshold);\r\n    }\r\n    return false;\r\n};\r\nvar PADDING_TIMER_KEY = '$ionPaddingTimer';\r\nvar enableScrollPadding = function (keyboardHeight) {\r\n    var doc = document;\r\n    var onFocusin = function (ev) {\r\n        setScrollPadding(ev.target, keyboardHeight);\r\n    };\r\n    var onFocusout = function (ev) {\r\n        setScrollPadding(ev.target, 0);\r\n    };\r\n    doc.addEventListener('focusin', onFocusin);\r\n    doc.addEventListener('focusout', onFocusout);\r\n    return function () {\r\n        doc.removeEventListener('focusin', onFocusin);\r\n        doc.removeEventListener('focusout', onFocusout);\r\n    };\r\n};\r\nvar setScrollPadding = function (input, keyboardHeight) {\r\n    if (input.tagName !== 'INPUT') {\r\n        return;\r\n    }\r\n    if (input.parentElement && input.parentElement.tagName === 'ION-INPUT') {\r\n        return;\r\n    }\r\n    if (input.parentElement &&\r\n        input.parentElement.parentElement &&\r\n        input.parentElement.parentElement.tagName === 'ION-SEARCHBAR') {\r\n        return;\r\n    }\r\n    var el = input.closest('ion-content');\r\n    if (el === null) {\r\n        return;\r\n    }\r\n    var timer = el[PADDING_TIMER_KEY];\r\n    if (timer) {\r\n        clearTimeout(timer);\r\n    }\r\n    if (keyboardHeight > 0) {\r\n        el.style.setProperty('--keyboard-offset', keyboardHeight + \"px\");\r\n    }\r\n    else {\r\n        el[PADDING_TIMER_KEY] = setTimeout(function () {\r\n            el.style.setProperty('--keyboard-offset', '0px');\r\n        }, 120);\r\n    }\r\n};\r\nvar INPUT_BLURRING = true;\r\nvar SCROLL_PADDING = true;\r\nvar startInputShims = function (config) {\r\n    var doc = document;\r\n    var keyboardHeight = config.getNumber('keyboardHeight', 290);\r\n    var scrollAssist = config.getBoolean('scrollAssist', true);\r\n    var hideCaret = config.getBoolean('hideCaretOnScroll', true);\r\n    var inputBlurring = config.getBoolean('inputBlurring', true);\r\n    var scrollPadding = config.getBoolean('scrollPadding', true);\r\n    var inputs = Array.from(doc.querySelectorAll('ion-input, ion-textarea'));\r\n    var hideCaretMap = new WeakMap();\r\n    var scrollAssistMap = new WeakMap();\r\n    var registerInput = function (componentEl) { return __awaiter(void 0, void 0, void 0, function () {\r\n        var inputRoot, inputEl, scrollEl, footerEl, rmFn, rmFn;\r\n        return __generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0:\r\n                    if (!componentEl.componentOnReady) return [3 /*break*/, 2];\r\n                    return [4 /*yield*/, componentEl.componentOnReady()];\r\n                case 1:\r\n                    _a.sent();\r\n                    _a.label = 2;\r\n                case 2:\r\n                    inputRoot = componentEl.shadowRoot || componentEl;\r\n                    inputEl = inputRoot.querySelector('input') || inputRoot.querySelector('textarea');\r\n                    scrollEl = componentEl.closest('ion-content');\r\n                    footerEl = (!scrollEl) ? componentEl.closest('ion-footer') : null;\r\n                    if (!inputEl) {\r\n                        return [2 /*return*/];\r\n                    }\r\n                    if (!!scrollEl && hideCaret && !hideCaretMap.has(componentEl)) {\r\n                        rmFn = enableHideCaretOnScroll(componentEl, inputEl, scrollEl);\r\n                        hideCaretMap.set(componentEl, rmFn);\r\n                    }\r\n                    if ((!!scrollEl || !!footerEl) && scrollAssist && !scrollAssistMap.has(componentEl)) {\r\n                        rmFn = enableScrollAssist(componentEl, inputEl, scrollEl, footerEl, keyboardHeight);\r\n                        scrollAssistMap.set(componentEl, rmFn);\r\n                    }\r\n                    return [2 /*return*/];\r\n            }\r\n        });\r\n    }); };\r\n    var unregisterInput = function (componentEl) {\r\n        if (hideCaret) {\r\n            var fn = hideCaretMap.get(componentEl);\r\n            if (fn) {\r\n                fn();\r\n            }\r\n            hideCaretMap.delete(componentEl);\r\n        }\r\n        if (scrollAssist) {\r\n            var fn = scrollAssistMap.get(componentEl);\r\n            if (fn) {\r\n                fn();\r\n            }\r\n            scrollAssistMap.delete(componentEl);\r\n        }\r\n    };\r\n    if (inputBlurring && INPUT_BLURRING) {\r\n        enableInputBlurring();\r\n    }\r\n    if (scrollPadding && SCROLL_PADDING) {\r\n        enableScrollPadding(keyboardHeight);\r\n    }\r\n    // Input might be already loaded in the DOM before ion-device-hacks did.\r\n    // At this point we need to look for all of the inputs not registered yet\r\n    // and register them.\r\n    for (var _i = 0, inputs_1 = inputs; _i < inputs_1.length; _i++) {\r\n        var input = inputs_1[_i];\r\n        registerInput(input);\r\n    }\r\n    doc.addEventListener('ionInputDidLoad', (function (ev) {\r\n        registerInput(ev.detail);\r\n    }));\r\n    doc.addEventListener('ionInputDidUnload', (function (ev) {\r\n        unregisterInput(ev.detail);\r\n    }));\r\n};\r\nexport { startInputShims };\r\n"]},"metadata":{},"sourceType":"module"}